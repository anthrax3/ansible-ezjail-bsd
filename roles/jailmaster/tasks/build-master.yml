- name: Build the master server
  shell: "{{ item }}"
  with_items:
   - jexec {{ masterserver_jail_name }} pkg install perl5 python27 vim screen shellinabox portupgrade vsftpd-ext bind910
   - jexec {{ masterserver_jail_name }} portinstall --batch sudo bash zsh unbound textmaze
  environment:
    ASSUME_ALWAYS_YES: "yes"
  tags: jexec

#in this operation we create the file on the host server and then transfer it to the jail
- name: Enable local DNS server for use by all trainees
  template:
    src: usr/local/etc/unbound/unbound.conf.j2
    dest: /usr/jails/{{ masterserver_jail_name }}/usr/local/etc/unbound/unbound.conf
    owner: root
    mode: 0644
  tags:
   - jexec
   - unbound

- name: Add unbound to start at FreeBSD boot
  shell: jexec {{ masterserver_jail_name }} sysrc unbound_enable=YES
  tags:
   - jexec
   - unbound

- name: Start unbound
  command: jexec {{ masterserver_jail_name }} service unbound start
  tags:
   - jexec
   - unbound
