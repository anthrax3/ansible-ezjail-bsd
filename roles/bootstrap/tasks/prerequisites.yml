# BSD doens't ship python. Let us install it
- name: Install Python
  raw: pkg install python
  tags:
   - python

- name: Update facts
  setup:

- name: update portsnap
  command: /usr/sbin/portsnap --interactive fetch extract
  tags:
   - ports
   - portsnap

- name: Unset X11
  shell: echo OPTIONS_UNSET=X11 >> /etc/make.conf
  tags: appends

- name: Enable ezjail
  shell: echo ezjail_enable=YES >> /etc/rc.conf
  tags: appends

- name: Gateway enable
  shell: echo gateway_enable=YES >> /etc/rc.conf
  tags: appends

- name: Enable Sysctl options
  shell: "{{ item }}"
  with_items:
   - echo security.jail.sysvipc_allowed=1 >> /etc/sysctl.conf
   - echo security.jail.allow_raw_sockets=1 >> /etc/sysctl.conf
   - sysctl security.jail.sysvipc_allowed=1 
   - sysctl security.jail.allow_raw_sockets=1
  tags:
   - sysctl
   - appends

- name: Install Port Upgrade
  shell: make install clean
  args:
    chdir: /usr/ports/ports-mgmt/portupgrade/
  tags:
   - ports

- name: Install Sudo, Screen, EzJAIL and Bash
  portinstall:
    name: sudo,screen,bash,ezjail
    state: present
  tags:
   - ports

- name: Start Ezjail service
  command: service ezjail start

- name: Enable BSD Cloned Interface
  shell: "{{ item }}"
  with_items:
   - echo cloned_interfaces=lo1 >> /etc/rc.conf
   - service netif cloneup
   - ezjail-admin install -p
